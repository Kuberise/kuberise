grafana:
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
      - name: Loki
        type: loki
        access: proxy
        url: http://loki-loki-distributed-gateway
        isDefault: false
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    hosts:
      - grafana.127.0.0.1.nip.io
    path: /

  grafana.ini:
    auth.generic_oauth:
      enabled: true
      name: Keycloak
      allow_sign_up: true
      client_id: grafana
      client_secret: $__file{/etc/grafana/secrets/clientSecret}
      scopes: openid email profile offline_access roles
      email_attribute_path: email
      login_attribute_path: username
      name_attribute_path: full_name
      auth_url: http://keycloak.127.0.0.1.nip.io/realms/platform/protocol/openid-connect/auth
      # token_url: http://keycloak.keycloak.svc.cluster.local/realms/platform/protocol/openid-connect/token
      token_url: http://keycloak.127.0.0.1.nip.io/realms/platform/protocol/openid-connect/token
      api_url: http://keycloak.127.0.0.1.nip.io/realms/platform/protocol/openid-connect/userinfo
      # role_attribute_strict: true
      role_attribute_path: contains(roles[*], 'admin') && 'Admin' || contains(roles[*], 'editor') && 'Editor' || 'Viewer'
      # allow_assign_grafana_admin: true  # enable grafanaAdmin login through Keycloak
    # auth:
    #   disable_login_form: false
    #   oauth_auto_login: false
    #   oauth_skip_org_role_update_sync: false
    #   skip_org_role_sync: false
    # users:
    #   auto_assign_org: true
    #   auto_assign_org_role: Viewer  # default org_role
    #   auto_assign_org_id: 1
    # security:
    #   disable_initial_admin_creation: true
    #   allow_embedding: true
    #   cookie_secure: false
    server:
      root_url: http://grafana.127.0.0.1.nip.io/
      domain: http://grafana.127.0.0.1.nip.io/


  extraSecretMounts:
    - name: grafana-keycloak-secrets
      mountPath: /etc/grafana/secrets
      secretName: grafana-keycloak-secret
      readOnly: true

prometheus:
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - prometheus.127.0.0.1.nip.io
    paths:
      - /
    pathType: Prefix
